DELIMITER $$
DROP PROCEDURE IF EXISTS `seva_final`.`sp_state_master` $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_state_master`(IN `stateMaster` JSON, IN `statement` VARCHAR(30), IN `flag` INT, IN `st_code` INT)
begin

declare i_country_code int;
declare i_state_name varchar(100);
declare i_short_name varchar(5);
declare i_created_at datetime;
declare i_updated_at datetime;
declare i_created_by varchar(30);
declare i_updated_by varchar(30);
declare i_status SMALLINT(10);

set i_country_code = JSON_EXTRACT(stateMaster,'$.country_code');
set i_state_name = JSON_EXTRACT(stateMaster,'$.state');
set i_short_name = JSON_EXTRACT(stateMaster,'$.state_short_name');
set i_created_at = CAST(jSON_UNQUOTE(JSON_EXTRACT(stateMaster,'$.created_at'))as DATETIME);
set i_updated_at = CAST(jSON_UNQUOTE(JSON_EXTRACT(stateMaster,'$.updated_at')) as DATETIME);
set i_updated_by = JSON_EXTRACT(stateMaster,'$.updated_by');
set i_created_by = JSON_EXTRACT(stateMaster,'$.created_by');
set i_status = JSON_EXTRACT(stateMaster,'$.active');
if flag=1 THEN
	if statement='Insert' then
		insert into state_master(country_code,state,state_short_name,created_at,updated_at,created_by,updated_by,active) values(i_country_code,i_state_name,i_short_name,i_created_at,i_updated_at,i_created_by,i_updated_by,i_status);
	elseif statement='Select' then
		SELECT country_master.country, state_master.state,state_master.state_short_name FROM country_master INNER JOIN state_master ON country_master.country_code=state_master.country_code;
    end if;
    else
    IF statement='Update' THEN
    	update state_master set country_code=i_country_code, state=i_state_name,state_short_name=i_short_name,active=i_status,created_at=i_created_at,updated_at=i_updated_at,updated_by=i_updated_by,created_by=i_created_by where state_code=cntry_code;
    ELSEIF statement='Delete' THEN
    	DELETE from state_master WHERE state_code=st_code;
	
	end if;
 end if;
	
end$$
DELIMITER ;